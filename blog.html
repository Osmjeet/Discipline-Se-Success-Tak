<!doctype html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blogs ‚Äî Discipline Se Success Tak</title>
  <meta name="description" content="Blog series ‚Äî Discipline Se Success Tak. Series-wise blog list. Click to expand inline. Easy to add new posts via posts.json + posts/*.html" />
  <style>
    :root{
      --bg: #f6fdfb;
      --card: #ffffff;
      --accent: #0b8f76;
      --accent-dark: #045a45;
      --muted: #5f6d69;
      -- radius: 12px;
      --maxw: 980px;
      --shadow: 0 8px 24px rgba(6,20,18,0.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:Inter, 'Noto Sans Devanagari', system-ui, -apple-system, "Segoe UI", Roboto, Arial;color:#123532}
    .site{max-width:var(--maxw);margin:18px auto;padding:18px}
    header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
    header .brand{display:flex;flex-direction:column}
    header h1{margin:0;font-size:18px;color:var(--accent-dark)}
    header p{margin:0;font-size:13px;color:var(--muted)}
    nav{margin-left:auto;display:flex;gap:12px;align-items:center}
    nav a{color:#fff;text-decoration:none;background:var(--accent);padding:8px 12px;border-radius:10px;font-weight:700}
    .layout{display:grid;grid-template-columns:320px 1fr;gap:18px}
    @media(max-width:880px){ .layout{grid-template-columns:1fr; } nav{display:none} }

    /* LEFT SIDEBAR */
    .sidebar{background:var(--card);padding:16px;border-radius:12px;box-shadow:var(--shadow);border:1px solid #ecf7f4}
    .search{display:block;width:100%;padding:10px 12px;border-radius:10px;border:1px solid #e6f7f0;background:#fbfffd;color:#123532;font-size:14px}
    .series-list{margin-top:14px}
    .series-btn{display:flex;justify-content:space-between;align-items:center;padding:10px;border-radius:10px;background:#f4fffb;border:1px solid #e6f7f0;margin-bottom:8px;cursor:pointer}
    .series-btn strong{color:var(--accent-dark)}
    .count{color:var(--muted);font-size:13px}

    /* MAIN */
    .main{min-height:300px}
    .panel{background:var(--card);padding:18px;border-radius:12px;box-shadow:var(--shadow);border:1px solid #ecf7f4}
    .series-block{margin-bottom:18px}
    .series-title{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-radius:10px;background:#f7fff9;border:1px solid #e6f7f0}
    .series-title h2{margin:0;font-size:16px;color:var(--accent-dark)}
    .list{margin-top:12px}
    .post-item{display:flex;justify-content:space-between;gap:14px;align-items:flex-start;padding:14px;border-radius:10px;border:1px solid #eef7f1;background:#ffffff;margin-bottom:10px}
    .post-left{flex:1}
    .post-title{margin:0;font-size:16px;color:#0b6b55}
    .post-preview{margin-top:6px;color:var(--muted);font-size:14px}
    .post-actions{display:flex;flex-direction:column;gap:8px;align-items:flex-end}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;text-decoration:none;font-weight:700;cursor:pointer;border:none}
    .btn.ghost{background:#f1fff8;color:var(--accent);border:1px solid #d8f3ea}
    .expand-area{margin-top:12px;padding:14px;background:#fbfffd;border-radius:10px;border:1px solid #edf9f3}
    .post-content{color:#123532;line-height:1.7}
    .meta{font-size:13px;color:var(--muted);margin-top:10px}

    /* highlight */
    mark.search-hit{background: #fff08a;color:#15492a;padding:0 4px;border-radius:4px}

    /* small helper */
    .small{font-size:13px;color:var(--muted)}

    footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  </style>
</head>
<body>
  <div class="site">

    <header>
      <div class="brand">
        <h1>Discipline Se Success Tak</h1>
        <p>Series-wise Blogs ‚Äî Click to expand inline</p>
      </div>

      <nav aria-hidden>
        <a href="index.html">üè† Home</a>
        <a href="author.html">üë§ Author</a>
        <a href="ebook.html">üìò Free Mini eBook</a>
      </nav>
    </header>

    <div class="layout">
      <!-- LEFT: Sidebar -->
      <aside class="sidebar" aria-label="Series & search">
        <input id="searchBox" class="search" placeholder="Search titles / previews..." />

        <div class="series-list" id="seriesList">
          <!-- series buttons will be injected here -->
        </div>

        <div class="small" style="margin-top:10px">Tip: Click series to expand, then Read to load post inline.</div>
      </aside>

      <!-- RIGHT: Main content -->
      <main class="main">
        <div class="panel" id="contentPanel">
          <!-- series blocks will be injected here -->
          <div id="placeholder" class="small" style="padding:20px;text-align:center;color:var(--muted)">
            Choose a post from left ‚Äî content will expand inline below the title.
          </div>
        </div>
      </main>
    </div>

    <footer>
      ¬© 2025 Jeet S Singh ‚Äî Discipline ‚Ä¢ Faith ‚Ä¢ Success
    </footer>
  </div>

<script>
/*
  blog.html ‚Äî dynamic loader.
  REQUIREMENTS:
   - posts.json in same folder (or adjust path)
   - posts/blog11.html, posts/blog12.html ... actual HTML content files
   - posts.json entries example:
     {
       "id": 11,
       "title": "Blog 11 ‚Äî Negativity ‡§ï‡•ã Identify ‡§ï‡§∞‡•ã",
       "preview": "Problem ‡§ï‡§æ ‡§™‡§π‡§≤‡§æ solution ‡§π‡•à ‡§â‡§∏‡•á ‡§™‡§π‡§ö‡§æ‡§®‡§®‡§æ‡•§ ...",
       "file": "posts/blog11.html"
     }
*/

const POSTS_JSON = 'posts.json'; // change path if needed

let posts = [];
let grouped = {}; // { "1-10": [post,...], "11-20": [...] }
const contentPanel = document.getElementById('contentPanel');
const seriesListEl = document.getElementById('seriesList');
const searchBox = document.getElementById('searchBox');

function groupKeyFromId(id){
  const groupStart = Math.floor((id-1)/10)*10 + 1;
  const groupEnd = groupStart + 9;
  return `${groupStart}-${groupEnd}`;
}

function niceSeriesLabel(key){
  const [s,e] = key.split('-');
  return `Series ${s}‚Äì${e}`;
}

function safeHTML(text){
  // minimal escape to avoid injection if JSON untrusted
  const div = document.createElement('div');
  div.textContent = text;
  return div.innerHTML;
}

/* highlight helper: wraps matches in <mark class="search-hit"> */
function highlightText(html, term){
  if(!term) return html;
  const esc = term.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');
  const re = new RegExp(`(${esc})`, 'ig');
  return html.replace(re, '<mark class="search-hit">$1</mark>');
}

async function loadPosts(){
  try{
    const r = await fetch(POSTS_JSON, {cache: 'no-store'});
    if(!r.ok) throw new Error('posts.json fetch failed');
    posts = await r.json();

    // sort by id
    posts.sort((a,b)=>a.id-b.id);

    grouped = {};
    for(const p of posts){
      const key = groupKeyFromId(p.id);
      if(!grouped[key]) grouped[key]=[];
      grouped[key].push(p);
    }

    renderSidebar();
    renderSeriesBlocks();
  }catch(err){
    console.error(err);
    contentPanel.innerHTML = `<div style="padding:18px;color:#b02a2a">Error loading posts.json ‚Äî check path and file. (${err.message})</div>`;
  }
}

/* Sidebar: list series with counts; clicking toggles scroll to series block */
function renderSidebar(){
  seriesListEl.innerHTML = '';
  const keys = Object.keys(grouped).sort((a,b)=> Number(a.split('-')[0]) - Number(b.split('-')[0]));
  for(const key of keys){
    const btn = document.createElement('div');
    btn.className='series-btn';
    btn.innerHTML = `<strong>${niceSeriesLabel(key)}</strong><span class="count">(${grouped[key].length})</span>`;
    btn.addEventListener('click', ()=> {
      // scroll to series block
      const target = document.querySelector(`[data-series="${key}"]`);
      if(target){
        target.scrollIntoView({behavior:'smooth',block:'start'});
        // optionally expand series (we keep all visible)
      }
    });
    seriesListEl.appendChild(btn);
  }
}

/* Main: render series blocks and items */
function renderSeriesBlocks(filterTerm=''){
  // remove placeholder if any
  const placeholder = document.getElementById('placeholder');
  if(placeholder) placeholder.remove();

  const keys = Object.keys(grouped).sort((a,b)=> Number(a.split('-')[0]) - Number(b.split('-')[0]));
  // clear existing series blocks (but keep panel)
  // We'll recreate everything for simplicity (filtering easier)
  // But keep scroll position? it's okay.
  // Remove all children except maybe new content
  const existingBlocks = contentPanel.querySelectorAll('.series-block');
  existingBlocks.forEach(n=>n.remove());

  for(const key of keys){
    const postsArr = grouped[key];
    // filter titles/previews by term
    const visible = postsArr.filter(p=>{
      if(!filterTerm) return true;
      const t = (p.title + ' ' + p.preview).toLowerCase();
      return t.includes(filterTerm.toLowerCase());
    });
    if(visible.length===0) continue; // hide series if nothing matches

    const block = document.createElement('section');
    block.className='series-block';
    block.dataset.series = key;

    const titleBar = document.createElement('div');
    titleBar.className='series-title';
    titleBar.innerHTML = `<h2>${niceSeriesLabel(key)}</h2><div class="small">(${visible.length})</div>`;
    block.appendChild(titleBar);

    const list = document.createElement('div');
    list.className='list';

    for(const p of visible){
      const item = document.createElement('div');
      item.className='post-item';
      item.id = `post-${p.id}`;

      const left = document.createElement('div');
      left.className='post-left';
      left.innerHTML = `<h3 class="post-title">${safeHTML(p.title)}</h3>
                        <div class="post-preview">${safeHTML(p.preview)}</div>
                        <div class="meta small">ID: ${p.id} ‚Äî File: ${p.file}</div>`;

      const actions = document.createElement('div');
      actions.className='post-actions';
      const readBtn = document.createElement('button');
      readBtn.className='btn';
      readBtn.textContent = 'Read';
      readBtn.addEventListener('click', ()=> toggleOpenPost(p, item, filterTerm));
      actions.appendChild(readBtn);

      const openHolder = document.createElement('div');
      openHolder.className='expand-area';
      openHolder.style.display='none';
      openHolder.innerHTML = `<div class="small">Loading...</div>`;
      openHolder.setAttribute('aria-hidden','true');

      item.appendChild(left);
      item.appendChild(actions);
      item.appendChild(openHolder);

      // replace preview highlight if filterTerm exists
      if(filterTerm){
        left.querySelector('.post-title').innerHTML = highlightText(left.querySelector('.post-title').innerHTML, filterTerm);
        left.querySelector('.post-preview').innerHTML = highlightText(left.querySelector('.post-preview').innerHTML, filterTerm);
      }

      list.appendChild(item);
    }

    block.appendChild(list);
    contentPanel.appendChild(block);
  }

  // If nothing matched at all, show message
  const anyBlocks = contentPanel.querySelectorAll('.series-block');
  if(anyBlocks.length===0){
    const msg = document.createElement('div');
    msg.className='small';
    msg.style.padding='20px;text-align:center;color:var(--muted)';
    msg.textContent = 'Koi result nahi mila. Search term hata kar dobara try karein.';
    contentPanel.appendChild(msg);
  }
}

/* toggle open: fetch post file and insert into expand area. Only one open at a time. */
async function toggleOpenPost(postMeta, itemEl, filterTerm){
  // close any other open
  const openAreas = document.querySelectorAll('.expand-area');
  openAreas.forEach(area=>{
    if(area!==itemEl.querySelector('.expand-area')){
      area.style.display='none';
      area.setAttribute('aria-hidden','true');
      area.innerHTML = '';
    }
  });

  const holder = itemEl.querySelector('.expand-area');
  const isVisible = holder.style.display !== 'none';

  if(isVisible){
    // close
    holder.style.display='none';
    holder.setAttribute('aria-hidden','true');
    holder.innerHTML='';
    return;
  }

  // open: fetch content
  holder.style.display = 'block';
  holder.setAttribute('aria-hidden','false');
  holder.innerHTML = `<div class="small">Loading...</div>`;

  try{
    const res = await fetch(postMeta.file, {cache: 'no-store'});
    if(!res.ok) throw new Error('file fetch failed');
    let html = await res.text();

    // Optional: strip full html wrapper if the file is a full HTML page.
    // We'll try to extract content inside <main> or body.
    // First check for marker <!-- POST CONTENT START --> to allow clean insert (you can add this marker).
    if(html.includes('<!-- POST CONTENT START -->')){
      html = html.split('<!-- POST CONTENT START -->')[1].split('<!-- POST CONTENT END -->')[0];
    } else {
      // fallback: try to extract inner of <main> or <article>
      const mainMatch = html.match(/<main[^>]*>([\s\S]*?)<\/main>/i);
      const articleMatch = html.match(/<article[^>]*>([\s\S]*?)<\/article>/i);
      const bodyMatch = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
      if(mainMatch) html = mainMatch[1];
      else if(articleMatch) html = articleMatch[1];
      else if(bodyMatch) html = bodyMatch[1];
      // else leave whole file (could be only inner fragment)
    }

    // highlight search term in loaded content if filterTerm present
    if(filterTerm){
      html = highlightText(html, filterTerm);
    }

    // sanitize minimal: we will place as innerHTML (assumes posts are trusted).
    holder.innerHTML = `<div class="post-content">${html}</div>
                        <div class="meta small">Written by Jeet S Singh ‚Äî Author of <a href="https://www.amazon.in/s?k=Discipline+Se+Success+Tak" target="_blank">Discipline Se Success Tak</a></div>`;

    // scroll so expanded content's top aligns with viewport (fixes the complaint)
    setTimeout(()=>{
      const top = itemEl.getBoundingClientRect().top + window.scrollY - 24; // offset a bit
      window.scrollTo({top, behavior:'smooth'});
    }, 60);

  }catch(err){
    console.error(err);
    holder.innerHTML = `<div style="color:#b02a2a">Error loading post content. (${err.message})</div>`;
  }
}

/* search handler */
let searchTimer = null;
searchBox.addEventListener('input', (e)=>{
  const v = e.target.value.trim();
  clearTimeout(searchTimer);
  searchTimer = setTimeout(()=>{
    renderSeriesBlocks(v);
    // also update sidebar visibility (we keep sidebar same; user can click series)
  }, 200);
});

/* initial load */
loadPosts();
</script>
</body>
</html>
